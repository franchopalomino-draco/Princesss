<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>📊 Escala de Clima Laboral CL-SPC</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Montserrat"', 'sans-serif']
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #f0f9ff 0%, #f8f4ff 100%);
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    .sparkle {
      position: absolute;
      pointer-events: none;
      opacity: 0.6;
      z-index: 0;
      font-size: 1rem;
    }
  </style>
</head>
<body class="min-h-screen py-4 px-2 relative overflow-hidden">
  <!-- Sparkles decorativos -->
  <div class="sparkle" style="top:10%; left:5%;">📊</div>
  <div class="sparkle" style="top:25%; right:8%;">📈</div>
  <div class="sparkle" style="bottom:20%; left:10%;">💼</div>
  <div class="sparkle" style="bottom:30%; right:12%;">🔍</div>

  <!-- Contenedor principal -->
  <div id="app" class="max-w-xl mx-auto bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-5 border border-blue-100 relative z-10">
    <!-- Pantalla de bienvenida -->
    <div id="welcomeScreen" class="text-center">
      <h1 class="text-3xl font-bold text-blue-700 mb-3">Escala de Clima Laboral CL-SPC</h1>
      <p class="text-gray-700 text-sm mb-6">Responde 50 preguntas y obtén un diagnóstico profesional de tu clima laboral.</p>
      <button id="startBtn" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-8 rounded-full text-lg transition shadow-lg">
        ¡Comenzar Evaluación!
      </button>
      <div class="mt-6 text-xl">🔍📊💼</div>
    </div>

    <!-- Pantalla de preguntas -->
    <div id="questionScreen" class="hidden">
      <div class="text-center mb-4">
        <div class="text-sm text-gray-500" id="progressText">Pregunta 1 de 50</div>
        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
          <div id="progressBar" class="bg-blue-500 h-2 rounded-full" style="width: 2%"></div>
        </div>
      </div>
      <div id="questionText" class="text-lg font-medium mb-6 text-center"></div>
      <div id="optionsContainer" class="space-y-3"></div>
      <div class="flex justify-between mt-6">
        <button id="prevBtn" class="px-4 py-2 text-gray-600 font-medium rounded-lg hover:bg-gray-100 hidden">← Anterior</button>
        <button id="nextBtn" class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700">Siguiente →</button>
      </div>
    </div>

    <!-- Pantalla de resultado -->
    <div id="resultScreen" class="hidden text-center">
      <h2 class="text-2xl font-bold text-indigo-600 mb-4">Resultado del Diagnóstico</h2>
      <div id="princessResult"></div>
      <div id="whatsappBtnContainer" class="mt-6"></div>
      <p class="mt-4 text-xs text-gray-500">Los resultados se enviarán automáticamente por WhatsApp.</p>
    </div>
  </div>

  <script>
    // Preguntas del CL-SPC (50 ítems)
    const questions = [
      "Existen oportunidades de progresar en tu entorno.",
      "Te sientes comprometido con el éxito de tu equipo.",
      "Tus líderes te brindan apoyo cuando enfrentas desafíos.",
      "Tienes acceso a la información que necesitas para hacer bien tu trabajo.",
      "Tus compañeros cooperan contigo de forma armoniosa.",
      "Tus superiores se interesan por tu crecimiento personal.",
      "Siempre das lo mejor de ti en cada tarea.",
      "Buscas mejorar continuamente en lo que haces.",
      "La información fluye con claridad a tu alrededor.",
      "Tus metas son inspiradoras y desafiantes.",
      "Participas en definir tus objetivos.",
      "Sientes que eres clave para el éxito colectivo.",
      "La retroalimentación que recibes te ayuda a crecer.",
      "Tu equipo tiene una relación armoniosa.",
      "Tienes libertad para tomar decisiones en tu rol.",
      "Se valora cuando das tu máximo esfuerzo.",
      "Estás profundamente comprometido con tu misión.",
      "Recibes la preparación necesaria para brillar.",
      "Hay canales claros para comunicarte.",
      "Tu equipo funciona como una verdadera familia.",
      "Reconocen tus logros con sinceridad.",
      "Cada día buscas hacer las cosas mejor.",
      "Tus responsabilidades están bien definidas.",
      "Puedes interactuar fácilmente con personas influyentes.",
      "Siempre buscas hacer tu mejor trabajo.",
      "Lo que haces te permite aprender y crecer.",
      "Tu trabajo diario contribuye a tu desarrollo personal.",
      "Tienes sistemas que te ayudan a organizarte.",
      "Juntos superan cualquier obstáculo.",
      "Los recursos se usan con sabiduría.",
      "Te ofrecen oportunidades para capacitarte.",
      "Tu labor diaria es estimulante y significativa.",
      "Tienes guías claras para cumplir tus tareas.",
      "La comunicación interna es abierta y fluida.",
      "Tu recompensa es justa comparada con otros.",
      "Tu entorno promueve tu crecimiento profesional.",
      "Estás orgulloso de lo que haces cada día.",
      "Tus objetivos están claramente definidos.",
      "Tus líderes escuchan tus ideas con atención.",
      "Tus metas están alineadas con un propósito mayor.",
      "Se fomenta la creatividad e innovación.",
      "Conoces la visión, misión y valores de tu entorno.",
      "Sigues planes y métodos bien establecidos.",
      "Existe colaboración entre todos los equipos.",
      "Cuentas con herramientas que facilitan tu trabajo.",
      "Reconocen tus logros con alegría.",
      "Tu entorno es ideal para tu bienestar.",
      "Siempre se actúa con justicia y equidad.",
      "Estás al tanto de lo que sucede en otros equipos.",
      "Tu recompensa refleja tu esfuerzo y resultados."
    ];

    const likertOptions = [
      { value: 1, label: "Nunca" },
      { value: 2, label: "Rara vez" },
      { value: 3, label: "A veces" },
      { value: 4, label: "Casi siempre" },
      { value: 5, label: "Siempre" }
    ];

    // Estado
    let currentQuestion = 0;
    const answers = new Array(50).fill(null);

    // Elementos del DOM
    const welcomeScreen = document.getElementById('welcomeScreen');
    const questionScreen = document.getElementById('questionScreen');
    const resultScreen = document.getElementById('resultScreen');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const progressText = document.getElementById('progressText');
    const progressBar = document.getElementById('progressBar');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const startBtn = document.getElementById('startBtn');

    // Iniciar
    startBtn.addEventListener('click', () => {
      welcomeScreen.classList.add('hidden');
      questionScreen.classList.remove('hidden');
      loadQuestion(currentQuestion);
    });

    function loadQuestion(index) {
      questionText.textContent = `${index + 1}. ${questions[index]}`;
      progressText.textContent = `Pregunta ${index + 1} de 50`;
      progressBar.style.width = `${((index + 1) / 50) * 100}%`;

      optionsContainer.innerHTML = '';
      likertOptions.forEach(opt => {
        const id = `opt${opt.value}`;
        const checked = answers[index] === opt.value ? 'checked' : '';
        optionsContainer.innerHTML += `
          <div class="flex items-center justify-center">
            <input type="radio" name="currentAnswer" id="${id}" value="${opt.value}" class="radio-custom hidden" ${checked}>
            <label for="${id}" class="cursor-pointer w-full max-w-xs px-4 py-3 rounded-xl border border-gray-300 hover:bg-blue-50 transition text-center font-medium">${opt.label}</label>
          </div>
        `;
      });

      prevBtn.classList.toggle('hidden', index === 0);
      nextBtn.textContent = index === 49 ? 'Ver Resultado 📊' : 'Siguiente →';
    }

    function saveAnswer() {
      const selected = document.querySelector('input[name="currentAnswer"]:checked');
      if (!selected) {
        alert("Por favor selecciona una opción.");
        return false;
      }
      answers[currentQuestion] = parseInt(selected.value);
      return true;
    }

    nextBtn.addEventListener('click', () => {
      if (!saveAnswer()) return;
      if (currentQuestion < 49) {
        currentQuestion++;
        loadQuestion(currentQuestion);
      } else {
        showResult();
      }
    });

    prevBtn.addEventListener('click', () => {
      if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion(currentQuestion);
      }
    });

    function showResult() {
      const total = answers.reduce((sum, val) => sum + val, 0);

      // Definición de factores (ítems del 1 al 50 → índices 0 a 49)
      const factores = {
        autorrealizacion: [0, 5, 10, 15, 20, 25, 30, 35, 40, 45],
        involucramiento: [1, 6, 11, 21, 26, 31, 36, 41, 46],
        supervision: [2, 7, 12, 17, 22, 27, 32, 37, 42, 47],
        comunicacion: [3, 8, 13, 18, 23, 33, 38, 43, 48],
        condiciones: [4, 9, 14, 19, 24, 29, 34, 39, 44, 49]
      };

      const puntajes = {
        autorrealizacion: factores.autorrealizacion.reduce((s, i) => s + answers[i], 0),
        involucramiento: factores.involucramiento.reduce((s, i) => s + answers[i], 0),
        supervision: factores.supervision.reduce((s, i) => s + answers[i], 0),
        comunicacion: factores.comunicacion.reduce((s, i) => s + answers[i], 0),
        condiciones: factores.condiciones.reduce((s, i) => s + answers[i], 0)
      };

      // Categoría diagnóstica
      let categoria;
      if (total >= 210) categoria = "Muy favorable";
      else if (total >= 170) categoria = "Favorable";
      else if (total >= 130) categoria = "Media";
      else if (total >= 90) categoria = "Desfavorable";
      else categoria = "Muy desfavorable";

      // Percentil aproximado (basado en Tabla 16 del manual)
      const percentil = total <= 112 ? "10%" :
                        total <= 144 ? "25%" :
                        total <= 168 ? "50%" :
                        total <= 193 ? "75%" : "90%";

      // Mensaje técnico para WhatsApp
      const mensaje = `📊 *RESULTADO ESCALA CLIMA LABORAL (CL-SPC)* 📊

*Puntaje Total:* ${total}/250
*Categoría:* ${categoria}
*Percentil estimado:* ${percentil} (vs. trabajadores de Lima)

*Desglose por factores:*
• Autorrealización: ${puntajes.autorrealizacion}/50
• Involucramiento: ${puntajes.involucramiento}/50
• Supervisión: ${puntajes.supervision}/50
• Comunicación: ${puntajes.comunicacion}/50
• Condiciones Laborales: ${puntajes.condiciones}/50

*Interpretación:* 
Percepción ${categoria.toLowerCase()} del clima laboral. Se recomienda revisar los factores con puntajes más bajos para intervención organizacional.

— Generado con Escala CL-SPC (Palma Carrillo, 2004)`;

      const encodedMsg = encodeURIComponent(mensaje);
      const waLink = `https://wa.me/51984006844?text=${encodedMsg}`;

      // Mostrar resultado en pantalla
      document.getElementById('princessResult').innerHTML = `
        <div class="text-3xl mb-3">📊</div>
        <p class="text-xl font-bold text-indigo-600">Clima Laboral: <span class="text-blue-600">${categoria}</span></p>
        <p class="mt-2 text-sm text-gray-700">Puntaje total: <strong>${total}/250</strong></p>
        <p class="text-xs text-gray-600 mt-2">Percentil estimado: ${percentil}</p>
        <div class="mt-4 text-left text-xs bg-gray-50 p-3 rounded">
          <p><strong>Factores:</strong></p>
          <p>• Autorrealización: ${puntajes.autorrealizacion}</p>
          <p>• Involucramiento: ${puntajes.involucramiento}</p>
          <p>• Supervisión: ${puntajes.supervision}</p>
          <p>• Comunicación: ${puntajes.comunicacion}</p>
          <p>• Condiciones: ${puntajes.condiciones}</p>
        </div>
      `;

      // Botón de WhatsApp
      document.getElementById('whatsappBtnContainer').innerHTML = `
        <a href="${waLink}" target="_blank" class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-5 rounded-full text-base transition shadow w-full max-w-xs mx-auto">
          <i class="fab fa-whatsapp mr-2"></i> Enviar Resultado
        </a>
      `;

      questionScreen.classList.add('hidden');
      resultScreen.classList.remove('hidden');
    }
  </script>
</body>
</html>
